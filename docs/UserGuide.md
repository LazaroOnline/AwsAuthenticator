
# User's Guide


## Requirements
- [Aws CLI](https://aws.amazon.com/cli/).
- [DotNet 6.0 Runtime](https://dotnet.microsoft.com/download).
- Windows (Currently only Windows is supported, but it should be easy to add support for Mac and Linux).


## Pre-requisites
You need to have already configured aws credentials file 
with a profile containing the permanent `aws_access_key_id` and `aws_secret_access_key`.
You should get those from [the aws console](https://console.aws.amazon.com/):  
Click on your user-name on the top right corner > "Security Credentials" > "Access keys for CLI, SDK, & API access" > "Create access key".  
So your `.aws\credentials` file should contain something like this:  
```
[default]
aws_access_key_id = AAAAAAAAAAA123456789
aws_secret_access_key = XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
```

## How to use
Open the app, enter the required fields and click on the "Update credentials" button,
this will edit your local aws credentials file at:  
`C:\Users\%USERNAME%\.aws\credentials`  

Editing the following fields, from the selected profile, with the new values from the command `aws sts get-session-token`:
- `aws_access_key_id`
- `aws_secret_access_key`
- `aws_session_token`


### Troubleshooting Errors
- `MultiFactorAuthentication failed with invalid MFA one time pass code.`:  
   This shows when the token is invalid or has already expired or already been used once.

- `The parameters: 'awsProfileSource' and 'awsProfileSource' should not be the same because that would override the permanent 'aws_access_key_id'/'aws_secret_access_key' with the temporal one.`:  
   Ensure that "Aws Profile Source" points to a different profile than "Aws Profile To Update".

- `(AccessDenied) when calling the GetSessionToken operation: Cannot call GetSessionToken with session credentials`:  
   This occurs when the "Aws Profile Source" you have selected contains an access key that is not the permanent one from aws-console, 
   but one generated by MFA as a temporal access key.


### UI Mode
Just running the app will show the UI with a form to fill in all required configuration.  
The configuration is automatically saved in the `AppSettings.json` file when the app closes.


### Console Mode
This app can be used from the command-line, 
if certain command-line parameters are found like the `--Aws:TokenCode` parameter, the app will run in console mode instead of launching the UI.
Example:  
```cmd
AwsCredentialManager.exe --Aws:AccountId 670441985101 --Aws:UserName YOURUSER@YOURCOMPANY.com --Aws:ProfileSource default  --Aws:Profile opsmfa --Aws:TokenCode 123456
# Or just:
AwsCredentialManager.exe -A 670441985101 -U YOURUSER@YOURCOMPANY.com -S default -P opsmfa -C 123456
```
If the app is already configured in the `AppSettings.json` file, then you only need to specify the `Token` parameter:
```cmd
AwsCredentialManager.exe -Token 123456 
```

## Configuration
The configuration is stored in a file named `AppSettings.json` placed next to the application.  

 Config parameter    | Short Name | Description
---------------------|------------|---------------------------------------------------------------------------------
 Aws > AccountId     |    -A      | 12 digit number of the AWS project account.
 Aws > UserName      |    -U      | Personal AWS user name, usually your email.
 Aws > ProfileSource |    -S      | AWS profile name that already contains the access keys. It should already exist in your `.aws\credentials` file.
 Aws > Profile       |    -P      | AWS profile name where the temp credentials will be added. If it doesn't exist it will be auto-generated.
 Aws > Token         | -T or -C   | MFA personal user token (one time token).

